package auth

import (
	"github.com/go-kit/kit/log"
	"github.com/gorilla/sessions"
	"github.com/stretchr/testify/assert"
	"github.com/thethan/fdr-users/pkg/gothic"
	"github.com/thethan/fdr-users/pkg/gothic/yahoo"
	"net/http"
	"testing"
)

func TestService_GetCredentialInformation(t *testing.T) {
	logger := log.NewNopLogger()
	yProvider := yahoo.New("", "", "")
	service := NewService(logger, yProvider)
	t.Run("getting information from string", func(t *testing.T) {
		cookieString := "MTU4NDQxMzkyMnxEdi1CQkFFQ180SUFBUkFCRUFBQV9nVTFfNElBQVFaemRISnBibWNNQndBRmVXRm9iMjhHYzNSeWFXNW5EUDRGRmdELUJSSWZpd2dBQUFBQUFBRF9USlJYeTZSY0FvVF9TOE43Ti1NY1Eydjd3ckRZd2RTR05yV0JCVEVjY3o1cXE4di05MlctWlpmdnFxaTZLSjY2cVgtZHVHVXVIRk01ZlotS2VSN1E5NjlmMFZCaVRaLVhIYlpIUmQ5alNkXy02cU5sTG9oZkV4d1hpT2J3al90SDBwU3dtOE15X1oxV1lKZmJtdFhGdElxSjlHcURKa2hJelpGYmczWGY2YVM3MGhFZHNtVTJzbUhiOGp0Mk5URS1HczJ3d0N4M0t1c1Q3SktRN3pudzVDTnd0VDN3akRZaGZWYTlCZFRMbGV0X0xnQVE5QVRUY29MSkhDNVQtZnN2MkMtUy15TDRMNExQb202TzBKNU9VVFpQZmRfLVlmNGktQVhCQ2YxTl8yQl9FZnhmc183WGlZYS1RekNjOXdILVR2b1VfamRIY3pURDN4VEFCVUFpT2hrX3cyRU05bHRiamFQd21QSjJrZFlldmRNcmV0ZXNGekJDMVNNaEQydXhhUGVVcEF4dlhDVXdXVHhNUmJ2UTh3ZmM3b2RTcE9LbldPRG5pN3hfa2ZmVGp4T1hKQkFodTY5aGRfby1jVlkzVl9qb1V4dkdyTU8xSVdqRzB5Y1l4RzlGU0hBYXN3YVZfekMzMW1IQkxLelFpc24weGFFSjd4WkxUR3dxTU5nT0QydUxyanlSbmdWNXF1Q2FyZTV0TksxWDhRRnQ0enlpSktUa1dSZENjMElFYU5ma1l6bU1NVm5OWHRuWFVJMExnQUdJZG4tMFRSeEVmaTE1b29NeEczbXRhXy1zTC03dDRXMm1LN3JYUXVodE83UFltcjlxWXpGRDRLdUxHenUzbUhydVZfTXRZYU1ZQXRQRF9PQ08zWFBfT2FidUVUd2g1OUZrRmEzU2l2RzU1OXpySXBKa1lwUTF3bi11NF9qUnc1c2ZEQ1ZINHV5ZTM0c1g3V2x5NkFud3JaWnlmWVBFU3NmTkIyX1FVeUFOSHc2M1ozTG95LXFzR0NDRk43MnVOSE9kMEZscEg2MTZjZmp0cG1tdVVlTHE1V0kxdzN2VHhrTnQ3TXdCRnRSNGYwc3RoMUkyMWJ4NWlqYmVxVGo5eEQxcXQtQzY0elFYWldmcmNoSDVNRlkzRXdZa1dVanVvYlZKN1J6ZXgzRlZoWG9TYTVrZnVMOUpjY2pNVUllV2Q3UUNXNlByWW1jeHdJakVMX250WXpBY2tsXzNhMWcwZGxNU3ZqM0psbU1ITDM3Zk4xV2kxelpKWWlqVUFfTjU2MmVzUHFCNGZOQnNvc0FSTi1PTzg2VmI4U0hWQU1PWmE2Ymg1WWhlUFRPVVhhNk9xVE13ekNVUWw0eFlPLUpNZGFtMVRRQ1Nra1FxQnBvcXdNM25jODhvX0lMdUI0dzR4amxzQXo5MGQxTFVIaDFMYUpXZG5iX3JKSmZ1Vm5kclM2RS1LSWJObG9IZ1RTMW5SU3p6OE1tenJjYmpwYllfU1BheTNyTmpPNnRpQWlpeDNUUThTUl9EbEQxNVNrNnJJSWt0NWVLbDlNNUh4RjYtN1VOVkpHUjJMdUdaaVBUYUZObThmV2JpNTVuZTctSjB6TGZ3SE8yejhwejRoUDA0bWhrSUl6RmpCSjB6bElLRmFWeW82QVVxZ2NROHBNRjZrQ29RN3VibWFoNmp5M2s3bFNIcDN4OWVkQ1NPZC1mcS10SVJBaF9NOUlVTkVqcm9XaEowakxvMm5JYUxHSXZ6VWFjNkd0RHBxN1dmMDBoWmt0aFk5SWlWc2lBOEs1UTlET3VrUHFsUXhfV2hXLTdoMDg4ZGJTNFdnaFZOVVJLS0VhOFM0bk5oNXp5WHQxcDM3UFZqdE1UMlRGSnNuYWVLa3JXLXZlV1hiaHpsNW8ydHNYZDd2eFk1VGZrVUZFTm8xNDRxMXJJWDdXMTZIQUhzbDQ5c2RpRmRSZUU2eGlSXzZGV0dHWk9lSU5uY052VWgwOTZMMklFekNTbmZXWDQxajFMRGlmVlplYTBYcFJMMmRXakYtZkVrTi16bzdmaGg0NjhIeWhEaFJGR1dGODNtY0Y2bnF6cUdYN1hUajVNSnN3bWk0djh2SThaNTNGREo4MmJhNjhBVmRmb0FpMkJLblNkbmo4ZlMwWEliQ1VoXzhlVjZMVEltNHZqWHNURHZVcUVISmZYeW42Y2ZwOGMybEJORTNIejZQaEdBQUQ4Qi1STm5iRUItbnlfZkZJR0JNMHVRTE1NU3dlbmZfd0VBQVBfX0FRQUFfXzhHdlFoZ1lBWUFBQT09fNJ0OmVjRPlyuVcv_zJVpnbPQZ_lf6jIzFTAG0KlLDf7"
		req, err := http.NewRequest(http.MethodGet, "/", nil)
		if err != nil {
			assert.Nil(t, err )
			t.FailNow()
		}
		cookie := sessions.NewCookie(gothic.SessionName, cookieString, &sessions.Options{})

		req.AddCookie(cookie)

		user, err := service.getUserFromHttp(req)
		if err != nil {
			assert.Nil(t, err, err.Error() )
			t.FailNow()
		}
		assert.Equal(t, "yahoo", user.Provider)
	})
}
